# Nginx configuration for reverse proxy and static file serving

events {
    worker_connections 1024; # Maximum connections per worker
}

http {
    include /etc/nginx/mime.types; # MIME type definitions
    default_type application/octet-stream; # Default MIME type

    # Upstream server - Django application running in container
    upstream django {
        server django:8000; # Docker service name and port
    }

    server {
        listen 80; # Listen on port 80
        server_name localhost; # Server name
        client_max_body_size 100M; # Maximum upload size

        # Proxy all requests to Django application
        location / {
            proxy_pass http://django; # Forward to upstream
            proxy_set_header Host $host; # Preserve original host header
            proxy_set_header X-Real-IP $remote_addr; # Client IP address
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Forwarded IP chain
            proxy_set_header X-Forwarded-Proto $scheme; # Original protocol (http/https)
        }

        # Serve static files directly from Nginx (faster than Django)
        location /static/ {
            alias /static/; # Directory containing static files
            expires 30d; # Cache for 30 days
            add_header Cache-Control "public, immutable"; # Cache control header
        }
        
        # Serve Django admin static files
        location /admin/static/ {
            alias /static/; # Same directory as regular static files
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
    }
}